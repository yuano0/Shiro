import{r as a,j as r,R as v}from"./index-qegmBwH1.js";import{u as N}from"./useQuery-44y7CkOR.js";import{p as z}from"./index-D4F-WjWJ.js";import{a as R}from"./main-1J4Kkp7S.js";import{J as L,b as S}from"./owner-4YVbz2PN.js";import{t as T}from"./toast-qMk_Ov--.js";import{u as O}from"./use-is-dark-13kBJDHw.js";import{s as y}from"./dom-NuJWIaAq.js";import{s as E,c as _}from"./helper-0r91fNX5.js";import{c as U}from"./lodash-Y39_oLIE.js";import{M as A}from"./StyledButton-Mj8l6PeD.js";import{a as B}from"./provider-jumr72cx.js";const b=a.forwardRef((i,s)=>{const{data:o,...l}=i,c=a.useMemo(()=>{if(!o)return{};const u=E(o);if(u)return{data:u};{const m=o.split(`
`),n=m[0],d=m.slice(1).join(`
`),t={};return n.startsWith("http")?t.refUrl=n:n.startsWith("ref:")&&(t.refUrl=`${L}/objects/${n.slice(4)}`),d.trim().length>0&&(t.patchDiffDelta=E(d)),t}},[o]),f=a.useRef(null);return a.useImperativeHandle(s,()=>({getRefData(){return f.current?.getRemoteData()},getDiffDelta(){return c.patchDiffDelta}})),r.jsx(w,{ref:f,...l,...c})});b.displayName="Excalidraw";const w=a.forwardRef(({data:i,refUrl:s,patchDiffDelta:o,viewModeEnabled:l=!0,zenModeEnabled:c=!0,onChange:f,className:u,showExtendButton:m=!0,onReady:n},d)=>{const t=v.useRef(),I=B(),P=S(),{data:p,isLoading:x}=N({queryKey:["excalidraw",s],queryFn:async({queryKey:e})=>{const[D,g]=e;return await(await fetch(g)).json()},enabled:!!s});a.useImperativeHandle(d,()=>({getRemoteData(){return p}}));const h=a.useMemo(()=>p?z(U(p),o):null,[p,s]),M=O(),k=a.useMemo(()=>{const e=i||h;return!e&&!x&&console.error("Excalidraw: data not exist"),e},[i,h,x]);return r.jsxs("div",{onKeyDown:y,onKeyUp:y,className:_("relative h-[500px] w-full",u),children:[x&&r.jsx("div",{className:"absolute inset-0 z-[10] flex center",children:r.jsx("div",{className:"loading loading-spinner"})}),r.jsx(R.Excalidraw,{theme:M?"dark":"light",initialData:k,detectScroll:!1,zenModeEnabled:c,onChange:f,viewModeEnabled:l,excalidrawAPI:e=>{t.current=e,setTimeout(()=>{e.scrollToContent(void 0,{fitToContent:!0})},1e3),n?.(e)}},s?`excalidraw-refData-loading-${x}`:"excalidraw"),l&&m&&r.jsx(A,{onClick:()=>{if(!t.current){T.error("Excalidraw API not ready");return}const e=t.current.getSceneElements();if(P){const D=window.open();R.exportToBlob({elements:e,files:null}).then(j=>{D?.location.replace(URL.createObjectURL(j))})}else I.present({title:"Preview",content:()=>r.jsx(w,{data:i,className:"h-full",showExtendButton:!1}),clickOutsideToDismiss:!0,max:!0})},className:_("absolute bottom-2 right-2 z-10 box-content flex h-5 w-5 rounded-md border p-2 center","border-zinc-200 bg-base-100 text-zinc-600","dark:border-neutral-800 dark:text-zinc-500"),children:r.jsx("i",{className:"icon-[mingcute--external-link-line]"})})]})});w.displayName="ExcalidrawImpl";const Y=Object.freeze(Object.defineProperty({__proto__:null,Excalidraw:b},Symbol.toStringTag,{value:"Module"})),Z=Object.freeze(Object.defineProperty({__proto__:null,Excalidraw:b},Symbol.toStringTag,{value:"Module"}));export{b as E,Y as a,Z as i};
