import{r as E,R as ne}from"./index-qegmBwH1.js";var h={BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};let oe=0;function pe(e,o){const l=`atom${++oe}`,p={toString:()=>l};return typeof e=="function"?p.read=e:(p.init=e,p.read=re,p.write=se),o&&(p.write=o),p}function re(e){return e(this)}function se(e,o,l){return o(this,typeof l=="function"?l(e(this)):l)}const D=(e,o)=>e.unstable_is?e.unstable_is(o):o===e,I=e=>"init"in e,U=e=>!!e.write,C=new WeakMap,ie=(e,o)=>{C.set(e,o),e.catch(()=>{}).finally(()=>C.delete(e))},x=(e,o)=>{const l=C.get(e);l&&(C.delete(e),l(o))},G=(e,o)=>{e.status="fulfilled",e.value=o},H=(e,o)=>{e.status="rejected",e.reason=o},ue=e=>typeof e?.then=="function",M=(e,o)=>!!e&&"v"in e&&"v"in o&&Object.is(e.v,o.v),K=(e,o)=>!!e&&"e"in e&&"e"in o&&Object.is(e.e,o.e),P=e=>!!e&&"v"in e&&e.v instanceof Promise,ce=(e,o)=>"v"in e&&"v"in o&&e.v.orig&&e.v.orig===o.v.orig,k=e=>{if("e"in e)throw e.e;return e.v},X=()=>{const e=new WeakMap,o=new WeakMap,l=new Map;let p,A;(h?"production":void 0)!=="production"&&(p=new Set,A=new Set);const _=t=>e.get(t),b=(t,r)=>{(h?"production":void 0)!=="production"&&Object.freeze(r);const s=_(t);if(e.set(t,r),l.has(t)||l.set(t,s),P(s)){const i="v"in r?r.v instanceof Promise?r.v:Promise.resolve(r.v):Promise.reject(r.e);s.v!==i&&x(s.v,i)}},S=(t,r,s,i)=>{const u=new Map(i?r.d:null);let c=!1;s.forEach((n,d)=>{!n&&D(t,d)&&(n=r),n?(u.set(d,n),r.d.get(d)!==n&&(c=!0)):(h?"production":void 0)!=="production"&&console.warn("[Bug] atom state not found")}),(c||r.d.size!==u.size)&&(r.d=u)},y=(t,r,s,i)=>{const u=_(t),c={d:u?.d||new Map,v:r};if(s&&S(t,c,s,i),M(u,c)&&u.d===c.d)return u;if(P(u)&&P(c)&&ce(u,c)){if(u.d===c.d)return u;c.v=u.v}return b(t,c),c},w=(t,r,s,i)=>{if(ue(r)){let u;const c=()=>{const d=_(t);if(!P(d)||d.v!==n)return;const v=y(t,n,s);o.has(t)&&d.d!==v.d&&q(t,v,d.d)},n=new Promise((d,v)=>{let f=!1;r.then(a=>{f||(f=!0,G(n,a),d(a),c())},a=>{f||(f=!0,H(n,a),v(a),c())}),u=a=>{f||(f=!0,a.then(g=>G(n,g),g=>H(n,g)),d(a))}});return n.orig=r,n.status="pending",ie(n,d=>{d&&u(d),i?.()}),y(t,n,s,!0)}return y(t,r,s)},R=(t,r,s)=>{const i=_(t),u={d:i?.d||new Map,e:r};return s&&S(t,u,s),K(i,u)&&i.d===u.d?i:(b(t,u),u)},m=(t,r)=>{const s=_(t);if(!r&&s&&(o.has(t)||Array.from(s.d).every(([f,a])=>{if(f===t)return!0;const g=m(f);return g===a||M(g,a)})))return s;const i=new Map;let u=!0;const c=f=>{if(D(t,f)){const g=_(f);if(g)return i.set(f,g),k(g);if(I(f))return i.set(f,void 0),f.init;throw new Error("no atom init")}const a=m(f);return i.set(f,a),k(a)};let n,d;const v={get signal(){return n||(n=new AbortController),n.signal},get setSelf(){return(h?"production":void 0)!=="production"&&!U(t)&&console.warn("setSelf function cannot be used with read-only atom"),!d&&U(t)&&(d=(...f)=>{if((h?"production":void 0)!=="production"&&u&&console.warn("setSelf function cannot be called in sync"),!u)return T(t,...f)}),d}};try{const f=t.read(c,v);return w(t,f,i,()=>n?.abort())}catch(f){return R(t,f,i)}finally{u=!1}},L=t=>k(m(t)),ee=t=>{let r=o.get(t);return r||(r=V(t)),r},N=(t,r)=>!r.l.size&&(!r.t.size||r.t.size===1&&r.t.has(t)),te=t=>{const r=o.get(t);r&&N(t,r)&&j(t)},J=t=>{const r=n=>{var d;const v=new Set((d=o.get(n))==null?void 0:d.t);return l.forEach((f,a)=>{var g;(g=_(a))!=null&&g.d.has(n)&&v.add(a)}),v},s=new Array,i=new Set,u=n=>{if(!i.has(n)){i.add(n);for(const d of r(n))n!==d&&u(d);s.push(n)}};u(t);const c=new Set([t]);for(let n=s.length-1;n>=0;--n){const d=s[n],v=_(d);if(!v)continue;let f=!1;for(const a of v.d.keys())if(a!==d&&c.has(a)){f=!0;break}if(f){const a=m(d,!0);M(v,a)||c.add(d)}}},W=(t,...r)=>{let s=!0;const i=n=>k(m(n)),u=(n,...d)=>{let v;if(D(t,n)){if(!I(n))throw new Error("atom not writable");const f=_(n),a=w(n,d[0]);M(f,a)||J(n)}else v=W(n,...d);if(!s){const f=O();(h?"production":void 0)!=="production"&&p.forEach(a=>a({type:"async-write",flushed:f}))}return v},c=t.write(i,u,...r);return s=!1,c},T=(t,...r)=>{const s=W(t,...r),i=O();return(h?"production":void 0)!=="production"&&p.forEach(u=>u({type:"write",flushed:i})),s},V=(t,r,s)=>{var i;const u=s||[];(i=_(t))==null||i.d.forEach((n,d)=>{const v=o.get(d);v?v.t.add(t):d!==t&&V(d,t,u)}),m(t);const c={t:new Set(r&&[r]),l:new Set};if(o.set(t,c),(h?"production":void 0)!=="production"&&A.add(t),U(t)&&t.onMount){const{onMount:n}=t;u.push(()=>{const d=n((...v)=>T(t,...v));d&&(c.u=d)})}return s||u.forEach(n=>n()),c},j=t=>{var r;const s=(r=o.get(t))==null?void 0:r.u;s&&s(),o.delete(t),(h?"production":void 0)!=="production"&&A.delete(t);const i=_(t);i?(P(i)&&x(i.v),i.d.forEach((u,c)=>{if(c!==t){const n=o.get(c);n&&(n.t.delete(t),N(c,n)&&j(c))}})):(h?"production":void 0)!=="production"&&console.warn("[Bug] could not find atom state to unmount",t)},q=(t,r,s)=>{const i=new Set(r.d.keys()),u=new Set;s?.forEach((c,n)=>{if(i.has(n)){i.delete(n);return}u.add(n);const d=o.get(n);d&&d.t.delete(t)}),i.forEach(c=>{const n=o.get(c);n?n.t.add(t):o.has(t)&&V(c,t)}),u.forEach(c=>{const n=o.get(c);n&&N(c,n)&&j(c)})},O=()=>{let t;for((h?"production":void 0)!=="production"&&(t=new Set);l.size;){const r=Array.from(l);l.clear(),r.forEach(([s,i])=>{const u=_(s);if(u){const c=o.get(s);c&&u.d!==i?.d&&q(s,u,i?.d),c&&!(!P(i)&&(M(i,u)||K(i,u)))&&(c.l.forEach(n=>n()),(h?"production":void 0)!=="production"&&t.add(s))}else(h?"production":void 0)!=="production"&&console.warn("[Bug] no atom state to flush")})}if((h?"production":void 0)!=="production")return t},$=(t,r)=>{const s=ee(t),i=O(),u=s.l;return u.add(r),(h?"production":void 0)!=="production"&&p.forEach(c=>c({type:"sub",flushed:i})),()=>{u.delete(r),te(t),(h?"production":void 0)!=="production"&&p.forEach(c=>c({type:"unsub"}))}};return(h?"production":void 0)!=="production"?{get:L,set:T,sub:$,dev_subscribe_store:(t,r)=>{if(r!==2)throw new Error("The current StoreListener revision is 2.");return p.add(t),()=>{p.delete(t)}},dev_get_mounted_atoms:()=>A.values(),dev_get_atom_state:t=>e.get(t),dev_get_mounted:t=>o.get(t),dev_restore_atoms:t=>{for(const[s,i]of t)I(s)&&(w(s,i),J(s));const r=O();p.forEach(s=>s({type:"restore",flushed:r}))}}:{get:L,set:T,sub:$}};let B;(h?"production":void 0)!=="production"&&(typeof globalThis.__NUMBER_OF_JOTAI_INSTANCES__=="number"?++globalThis.__NUMBER_OF_JOTAI_INSTANCES__:globalThis.__NUMBER_OF_JOTAI_INSTANCES__=1);const Y=()=>(B||((h?"production":void 0)!=="production"&&globalThis.__NUMBER_OF_JOTAI_INSTANCES__!==1&&console.warn("Detected multiple Jotai instances. It may cause unexpected behavior with the default store. https://github.com/pmndrs/jotai/discussions/2044"),B=X()),B);var de={BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const Z=E.createContext(void 0),Q=e=>{const o=E.useContext(Z);return e?.store||o||Y()},_e=({children:e,store:o})=>{const l=E.useRef();return!o&&!l.current&&(l.current=X()),E.createElement(Z.Provider,{value:o||l.current},e)},le=e=>typeof e?.then=="function",fe=ne.use||(e=>{if(e.status==="pending")throw e;if(e.status==="fulfilled")return e.value;throw e.status==="rejected"?e.reason:(e.status="pending",e.then(o=>{e.status="fulfilled",e.value=o},o=>{e.status="rejected",e.reason=o}),e)});function ae(e,o){const l=Q(o),[[p,A,_],b]=E.useReducer(w=>{const R=l.get(e);return Object.is(w[0],R)&&w[1]===l&&w[2]===e?w:[R,l,e]},void 0,()=>[l.get(e),l,e]);let S=p;(A!==l||_!==e)&&(b(),S=l.get(e));const y=o?.delay;return E.useEffect(()=>{const w=l.sub(e,()=>{if(typeof y=="number"){setTimeout(b,y);return}b()});return b(),w},[l,e,y]),E.useDebugValue(S),le(S)?fe(S):S}function ve(e,o){const l=Q(o);return E.useCallback((...A)=>{if((de?"production":void 0)!=="production"&&!("write"in e))throw new Error("not writable atom");return l.set(e,...A)},[l,e])}function ge(e,o){return[ae(e,o),ve(e,o)]}let z,F=Symbol(),we=()=>{if(z)return z;if(globalThis[F])return globalThis[F];let e=Y();return z=e,globalThis[F]=e,e};export{_e as P,pe as a,ae as b,Q as c,ge as d,we as r,ve as u};
