import{R as oe,r as g,j as s,i as U}from"./index-qegmBwH1.js";import{c as re,a as je}from"./helper-0r91fNX5.js";import{i as Ie}from"./index-5Y6ZmVAf.js";import{c as Ce,L as He}from"./image-sZM8elMx.js";import{u as Oe,D as J}from"./use-is-unmounted-6i0OwE-p.js";import{a as Pe}from"./env-y9k74Ds6.js";import{j as ie,s as Ae}from"./store-gmK8mRDy.js";import{a as _,b as ae,u as Q}from"./init-a0893ef4-4662SO8Z.js";import{t as Ne}from"./lodash-Y39_oLIE.js";const Re=({contexts:n,children:e})=>n.reduceRight((o,i)=>oe.cloneElement(i,{children:o}),e),$=typeof window<"u"?g.useLayoutEffect:g.useEffect,Te=_(!1),_e=n=>ie.set(Te,n),ke=_(0),se=_(null),wt=({children:n})=>s.jsxs(s.Fragment,{children:[s.jsx(Me,{}),n]}),Me=()=>{const n=Q(ke),e=Q(se),o=g.useRef(0),i=g.useRef(!1);return $(()=>{const c=Ne(()=>{i.current||(_e(!0),i.current=!0);const m=document.documentElement.scrollTop;e(o.current-m>0?"up":"down"),o.current=m,g.startTransition(()=>{n(o.current)})},16,{leading:!1});return window.addEventListener("scroll",c),c(),()=>{window.removeEventListener("scroll",c)}},[]),null},We=()=>ae(se),De=n=>{const e=g.useRef();return e.current||(e.current=n()),e.current};/*! medium-zoom 1.1.0 | MIT License | https://github.com/francoischalifour/medium-zoom */var O=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])}return n},D=function(e){return e.tagName==="IMG"},Fe=function(e){return NodeList.prototype.isPrototypeOf(e)},F=function(e){return e&&e.nodeType===1},ee=function(e){var o=e.currentSrc||e.src;return o.substr(-4).toLowerCase()===".svg"},te=function(e){try{return Array.isArray(e)?e.filter(D):Fe(e)?[].slice.call(e).filter(D):F(e)?[e].filter(D):typeof e=="string"?[].slice.call(document.querySelectorAll(e)).filter(D):[]}catch{throw new TypeError(`The provided selector is invalid.
Expects a CSS selector, a Node element, a NodeList or an array.
See: https://github.com/francoischalifour/medium-zoom`)}},Ue=function(e){var o=document.createElement("div");return o.classList.add("medium-zoom-overlay"),o.style.background=e,o},Ye=function(e){var o=e.getBoundingClientRect(),i=o.top,c=o.left,m=o.width,S=o.height,u=e.cloneNode(),y=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,E=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;return u.removeAttribute("id"),u.style.position="absolute",u.style.top=i+y+"px",u.style.left=c+E+"px",u.style.width=m+"px",u.style.height=S+"px",u.style.transform="",u},R=function(e,o){var i=O({bubbles:!1,cancelable:!1,detail:void 0},o);if(typeof window.CustomEvent=="function")return new CustomEvent(e,i);var c=document.createEvent("CustomEvent");return c.initCustomEvent(e,i.bubbles,i.cancelable,i.detail),c},qe=function n(e){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=window.Promise||function(r){function a(){}r(a,a)},c=function(r){var a=r.target;if(a===M){x();return}w.indexOf(a)!==-1&&b({target:a})},m=function(){if(!(A||!t.original)){var r=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;Math.abs(V-r)>l.scrollOffset&&setTimeout(x,150)}},S=function(r){var a=r.key||r.keyCode;(a==="Escape"||a==="Esc"||a===27)&&x()},u=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=r;if(r.background&&(M.style.background=r.background),r.container&&r.container instanceof Object&&(a.container=O({},l.container,r.container)),r.template){var f=F(r.template)?r.template:document.querySelector(r.template);a.template=f}return l=O({},l,a),w.forEach(function(p){p.dispatchEvent(R("medium-zoom:update",{detail:{zoom:h}}))}),h},y=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return n(O({},l,r))},E=function(){for(var r=arguments.length,a=Array(r),f=0;f<r;f++)a[f]=arguments[f];var p=a.reduce(function(d,z){return[].concat(d,te(z))},[]);return p.filter(function(d){return w.indexOf(d)===-1}).forEach(function(d){w.push(d),d.classList.add("medium-zoom-image")}),k.forEach(function(d){var z=d.type,j=d.listener,N=d.options;p.forEach(function(I){I.addEventListener(z,j,N)})}),h},L=function(){for(var r=arguments.length,a=Array(r),f=0;f<r;f++)a[f]=arguments[f];t.zoomed&&x();var p=a.length>0?a.reduce(function(d,z){return[].concat(d,te(z))},[]):w;return p.forEach(function(d){d.classList.remove("medium-zoom-image"),d.dispatchEvent(R("medium-zoom:detach",{detail:{zoom:h}}))}),w=w.filter(function(d){return p.indexOf(d)===-1}),h},C=function(r,a){var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return w.forEach(function(p){p.addEventListener("medium-zoom:"+r,a,f)}),k.push({type:"medium-zoom:"+r,listener:a,options:f}),h},P=function(r,a){var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return w.forEach(function(p){p.removeEventListener("medium-zoom:"+r,a,f)}),k=k.filter(function(p){return!(p.type==="medium-zoom:"+r&&p.listener.toString()===a.toString())}),h},H=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=r.target,f=function(){var d={width:document.documentElement.clientWidth,height:document.documentElement.clientHeight,left:0,top:0,right:0,bottom:0},z=void 0,j=void 0;if(l.container)if(l.container instanceof Object)d=O({},d,l.container),z=d.width-d.left-d.right-l.margin*2,j=d.height-d.top-d.bottom-l.margin*2;else{var N=F(l.container)?l.container:document.querySelector(l.container),I=N.getBoundingClientRect(),Y=I.width,pe=I.height,he=I.left,ve=I.top;d=O({},d,{width:Y,height:pe,left:he,top:ve})}z=z||d.width-l.margin*2,j=j||d.height-l.margin*2;var T=t.zoomedHd||t.original,ze=ee(T)?z:T.naturalWidth||z,ye=ee(T)?j:T.naturalHeight||j,W=T.getBoundingClientRect(),Ee=W.top,xe=W.left,q=W.width,B=W.height,be=Math.min(Math.max(q,ze),z)/q,we=Math.min(Math.max(B,ye),j)/B,Z=Math.min(be,we),Se=(-xe+(z-q)/2+l.margin+d.left)/Z,Le=(-Ee+(j-B)/2+l.margin+d.top)/Z,G="scale("+Z+") translate3d("+Se+"px, "+Le+"px, 0)";t.zoomed.style.transform=G,t.zoomedHd&&(t.zoomedHd.style.transform=G)};return new i(function(p){if(a&&w.indexOf(a)===-1){p(h);return}var d=function Y(){A=!1,t.zoomed.removeEventListener("transitionend",Y),t.original.dispatchEvent(R("medium-zoom:opened",{detail:{zoom:h}})),p(h)};if(t.zoomed){p(h);return}if(a)t.original=a;else if(w.length>0){var z=w;t.original=z[0]}else{p(h);return}if(t.original.dispatchEvent(R("medium-zoom:open",{detail:{zoom:h}})),V=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,A=!0,t.zoomed=Ye(t.original),document.body.appendChild(M),l.template){var j=F(l.template)?l.template:document.querySelector(l.template);t.template=document.createElement("div"),t.template.appendChild(j.content.cloneNode(!0)),document.body.appendChild(t.template)}if(t.original.parentElement&&t.original.parentElement.tagName==="PICTURE"&&t.original.currentSrc&&(t.zoomed.src=t.original.currentSrc),document.body.appendChild(t.zoomed),window.requestAnimationFrame(function(){document.body.classList.add("medium-zoom--opened")}),t.original.classList.add("medium-zoom-image--hidden"),t.zoomed.classList.add("medium-zoom-image--opened"),t.zoomed.addEventListener("click",x),t.zoomed.addEventListener("transitionend",d),t.original.getAttribute("data-zoom-src")){t.zoomedHd=t.zoomed.cloneNode(),t.zoomedHd.removeAttribute("srcset"),t.zoomedHd.removeAttribute("sizes"),t.zoomedHd.removeAttribute("loading"),t.zoomedHd.src=t.zoomed.getAttribute("data-zoom-src"),t.zoomedHd.onerror=function(){clearInterval(N),console.warn("Unable to reach the zoom image target "+t.zoomedHd.src),t.zoomedHd=null,f()};var N=setInterval(function(){t.zoomedHd.complete&&(clearInterval(N),t.zoomedHd.classList.add("medium-zoom-image--opened"),t.zoomedHd.addEventListener("click",x),document.body.appendChild(t.zoomedHd),f())},10)}else if(t.original.hasAttribute("srcset")){t.zoomedHd=t.zoomed.cloneNode(),t.zoomedHd.removeAttribute("sizes"),t.zoomedHd.removeAttribute("loading");var I=t.zoomedHd.addEventListener("load",function(){t.zoomedHd.removeEventListener("load",I),t.zoomedHd.classList.add("medium-zoom-image--opened"),t.zoomedHd.addEventListener("click",x),document.body.appendChild(t.zoomedHd),f()})}else f()})},x=function(){return new i(function(r){if(A||!t.original){r(h);return}var a=function f(){t.original.classList.remove("medium-zoom-image--hidden"),document.body.removeChild(t.zoomed),t.zoomedHd&&document.body.removeChild(t.zoomedHd),document.body.removeChild(M),t.zoomed.classList.remove("medium-zoom-image--opened"),t.template&&document.body.removeChild(t.template),A=!1,t.zoomed.removeEventListener("transitionend",f),t.original.dispatchEvent(R("medium-zoom:closed",{detail:{zoom:h}})),t.original=null,t.zoomed=null,t.zoomedHd=null,t.template=null,r(h)};A=!0,document.body.classList.remove("medium-zoom--opened"),t.zoomed.style.transform="",t.zoomedHd&&(t.zoomedHd.style.transform=""),t.template&&(t.template.style.transition="opacity 150ms",t.template.style.opacity=0),t.original.dispatchEvent(R("medium-zoom:close",{detail:{zoom:h}})),t.zoomed.addEventListener("transitionend",a)})},b=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=r.target;return t.original?x():H({target:a})},ue=function(){return l},fe=function(){return w},ge=function(){return t.original},w=[],k=[],A=!1,V=0,l=o,t={original:null,zoomed:null,zoomedHd:null,template:null};Object.prototype.toString.call(e)==="[object Object]"?l=e:(e||typeof e=="string")&&E(e),l=O({margin:0,background:"#fff",scrollOffset:40,container:null,template:null},l);var M=Ue(l.background);document.addEventListener("click",c),document.addEventListener("keyup",S),document.addEventListener("scroll",m),window.addEventListener("resize",x);var h={open:H,close:x,toggle:b,update:u,clone:y,attach:E,detach:L,on:C,off:P,getOptions:ue,getImages:fe,getZoomedImage:ge};return h};function Be(n,e){e===void 0&&(e={});var o=e.insertAt;if(!(!n||typeof document>"u")){var i=document.head||document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css",o==="top"&&i.firstChild?i.insertBefore(c,i.firstChild):i.appendChild(c),c.styleSheet?c.styleSheet.cssText=n:c.appendChild(document.createTextNode(n))}}var Ze=".medium-zoom-overlay{position:fixed;top:0;right:0;bottom:0;left:0;opacity:0;transition:opacity .3s;will-change:opacity}.medium-zoom--opened .medium-zoom-overlay{cursor:pointer;cursor:zoom-out;opacity:1}.medium-zoom-image{cursor:pointer;cursor:zoom-in;transition:transform .3s cubic-bezier(.2,0,.2,1)!important}.medium-zoom-image--hidden{visibility:hidden}.medium-zoom-image--opened{position:relative;cursor:pointer;cursor:zoom-out;will-change:transform}";Be(Ze);const Xe=n=>oe.createElement("img",n,n.children),de=g.createContext(_([])),St=({children:n,images:e})=>{const o=De(()=>_(e));return g.useEffect(()=>{ie.set(o,e)},[e]),s.jsx(de.Provider,{value:o,children:n})},ce=n=>ae(Ae(g.useContext(de),g.useCallback(e=>e.find(o=>o.src===n),[n]))),$e="_error_hef56_1",Ke="_loading_hef56_2",Ve="_loaded_hef56_6",Ge="_imageLoad_hef56_1",ne={error:$e,loading:Ke,loaded:Ve,imageLoad:Ge},K=Ie({base:"rounded-xl overflow-hidden text-center inline-flex items-center justify-center duration-200",variants:{status:{loading:"hidden opacity-0",loaded:"opacity-100 block",error:"hidden opacity-0"}}});let X;const Je=({alt:n,src:e,title:o,zoom:i,placeholder:c,height:m,width:S,className:u})=>{const[y]=g.useState(()=>{if(Pe)return null;if(X)return X;const b=qe(void 0);return X=b,b}),E=o||n,[L,C]=g.useState("loading"),P=Oe(),H=g.useCallback(b=>{P.current||C(b)},[P]),x=g.useRef(null);return $(()=>{if(L!=="loaded"||!i)return;const b=x.current;if(b)return y.attach(b),()=>{y.detach(b)}},[i,y,L]),s.jsxs("figure",{children:[s.jsx("span",{className:"relative flex justify-center","data-hide-print":!0,children:s.jsxs(He,{placeholder:c,offset:30,children:[s.jsx("span",{children:L!=="loaded"&&c}),L==="error"&&s.jsxs("div",{className:"absolute inset-0 z-[1] flex flex-col gap-8 center",children:[s.jsx("i",{className:"icon-[mingcute--close-line] text-4xl text-red-500"}),s.jsx("span",{children:"图片加载失败"}),s.jsx(J,{className:"w-[80px] opacity-80"}),s.jsx("a",{href:e,target:"_blank",rel:"noreferrer",children:s.jsx("span",{children:"查看原图"})})]}),s.jsx(le,{height:m,width:S,src:e,title:o,alt:n||o||"",ref:x,onLoad:()=>{H("loaded")},onError:()=>H("error"),className:K({status:L,className:je(ne.loaded,u)}),onAnimationEnd:b=>{b.target.classList.remove(ne.loaded)}})]})}),s.jsx("img",{className:"max-w-1/3 !hidden print:!block",src:e,alt:n||o}),!!E&&s.jsxs("figcaption",{className:"mt-1 flex flex-col items-center justify-center",children:[s.jsx(J,{className:"w-[80px] opacity-80"}),s.jsx("span",{children:E})]})]})},Lt=n=>{const e=g.useMemo(()=>s.jsx(Qe,{...n}),[n]);return s.jsx(Je,{zoom:!0,placeholder:e,...n})},Qe=({src:n,containerWidth:e,height:o,width:i,accent:c})=>{const m=ce(n),S=c||m?.accent,u=g.useMemo(()=>{let y=o,E=i;if(!y||!E){if(!m)return;y=m.height,E=m.width}if(e<=0)return;const{height:L,width:C}=Ce({width:E,height:y,max:{width:e,height:1/0}});return{scaleHeight:L,scaleWidth:C}},[o,i,e,m]);return u?s.jsx("span",{className:`image-placeholder ${K.base}`,"data-width":u.scaleWidth,"data-height":u.scaleHeight,"data-from-record-height":m?.height,"data-from-record-width":m?.width,"data-src":n,style:{height:u.scaleHeight,width:u.scaleWidth,backgroundColor:S}}):s.jsx(et,{accent:S})},et=({accent:n})=>s.jsx("span",{className:re("image-placeholder",K.base,"h-[300px] w-full bg-slate-300 dark:bg-slate-700"),style:{backgroundColor:n,outline:void 0}}),le=g.forwardRef(({src:n,alt:e,...o},i)=>{const{height:c,width:m}=ce(n)||o;return!c||!m?s.jsx("img",{alt:e,src:n,ref:i,...o}):s.jsx(Xe,{alt:e||"",fetchPriority:"high",priority:!0,src:n,...o,height:+c,width:+m,ref:i})});le.displayName="OptimizedImage";const tt=n=>{const e=g.useRef(n);return g.useEffect(()=>{e.current=n},[n]),e},[nt,ot,rt]=U(void 0),[it,jt,at]=U({h:0,w:0}),[st,It,dt]=U({x:0,y:0}),[ct,Ct,lt]=U(!1),mt=[s.jsx(nt,{},"ArticleElementProviderInternal"),s.jsx(it,{},"ElementSizeProviderInternal"),s.jsx(st,{},"ElementPositionProviderInternal"),s.jsx(ct,{},"IsEOArticleElementProviderInternal")],Ht=({children:n,className:e})=>s.jsxs(Re,{contexts:mt,children:[s.jsx(ut,{}),s.jsx(me,{className:e,children:n})]}),ut=()=>{const n=at(),e=dt(),o=ot();return $(()=>{if(!o)return;const{height:i,width:c,x:m,y:S}=o.getBoundingClientRect();n({h:i,w:c}),e({x:m,y:S});const u=new ResizeObserver(y=>{const E=y[0],{height:L,width:C,x:P,y:H}=E.contentRect;n({h:L,w:C}),e({x:P,y:H})});return u.observe(o),()=>{u.unobserve(o),u.disconnect()}},[o]),null},me=g.memo(({children:n,className:e})=>{const o=rt();return s.jsxs("div",{className:re("relative",e),ref:o,children:[n,s.jsx(ft,{})]})});me.displayName="ArticleElementProviderContent";const ft=()=>{const n=We(),e=tt(n),o=lt(),i=g.useRef(null);return g.useEffect(()=>{if(!i.current)return;const c=i.current,m=new IntersectionObserver(S=>{const u=S[0];!u.isIntersecting&&e.current==="down"||o(u.isIntersecting)},{rootMargin:"0px 0px 0px 0px"});return m.observe(c),()=>{m.unobserve(c),m.disconnect()}},[]),s.jsx("div",{ref:i})};export{Lt as F,Xe as I,St as M,Re as P,Ht as W,ce as a,tt as b,De as c,wt as d,$ as e,qe as m,jt as u};
