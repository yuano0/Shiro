import{j as e,r as o}from"./index-qegmBwH1.js";import{u as p}from"./useQuery-44y7CkOR.js";import{w as P,L}from"./index-I7weg1Js.js";import{M as I,R as m,N as R,q as T,A as C,P as B,X as S,g as z}from"./utils-t32ZRaBl.js";import{a as h,b as F}from"./provider-jumr72cx.js";import{L as g,M as A}from"./StyledButton-Mj8l6PeD.js";import{R as E,F as V}from"./FloatPopover-1BpKQIdq.js";import{c as f,a as d}from"./helper-0r91fNX5.js";import{r as j,R as y,u as c,M as D,a as $}from"./CurrentPostDataProvider-sxwUfZTo.js";import{b as q,k as v,m as u}from"./owner-4YVbz2PN.js";import"./toast-qMk_Ov--.js";import{M as H,W as O}from"./WrappedElementProvider-5243oAX6.js";import"./store-gmK8mRDy.js";import{A as w}from"./spring--xEiX8r3.js";import{m as b}from"./motion-minimal-gJqnz197.js";import{a as N,b as W}from"./init-a0893ef4-4662SO8Z.js";import{T as X,a as Z,n as x,B as K,L as Q}from"./Markdown-hVdCypI9.js";import"./AutoResizeHeight-pHZ_oyCK.js";import{R as G}from"./LinkCard-r30gHz-0.js";import{P as J}from"./PinIconToggle-aUENNNd6.js";import"./usePeek-N6a5Jy_H.js";import"./customParseFormat-3OBJgCTU.js";import"./use-is-unmounted-6i0OwE-p.js";import"./use-event-callback-nMlqCkS7.js";import"./dom-NuJWIaAq.js";import"./visual-element-YIiczwVf.js";import"./index-5Y6ZmVAf.js";import"./use-is-client-IECHC2ux.js";import"./env-y9k74Ds6.js";import"./image-sZM8elMx.js";import"./lodash-Y39_oLIE.js";import"./script-SYgWefdU.js";import"./Gallery-MHeEsxti.js";import"./SocialSourceLink-c8HgVvxv.js";import"./CodeHighlighter-Sy1nPjje.js";import"./use-is-dark-13kBJDHw.js";import"./Collapse-Q-wSwlx_.js";function U(t){return e.jsx("svg",{width:"1em",height:"1em",viewBox:"0 0 24 24",...t,children:e.jsx("path",{fill:"currentColor",fillRule:"evenodd",d:"M10 15h4V9h-4v6Zm0 2v3a1 1 0 0 1-2 0v-3H5a1 1 0 0 1 0-2h3V9H5a1 1 0 1 1 0-2h3V4a1 1 0 1 1 2 0v3h4V4a1 1 0 0 1 2 0v3h3a1 1 0 0 1 0 2h-3v6h3a1 1 0 0 1 0 2h-3v3a1 1 0 0 1-2 0v-3h-4Z"})})}function Y(){return e.jsx("i",{className:"icon-[mingcute--thumb-up-line]"})}const _=()=>e.jsx("svg",{version:"1.1",x:"0px",y:"0px",width:"59.227px",height:"59.227px",viewBox:"0 0 59.227 59.227",className:"fill-current",children:e.jsx("g",{children:e.jsx("g",{children:e.jsx("path",{d:`M51.586,10.029c-0.333-0.475-0.897-0.689-1.449-0.607c-0.021-0.005-0.042-0.014-0.063-0.017L27.469,6.087
			c-0.247-0.037-0.499-0.01-0.734,0.076L8.63,12.799c-0.008,0.003-0.015,0.008-0.023,0.011c-0.019,0.008-0.037,0.02-0.057,0.027
			c-0.099,0.044-0.191,0.096-0.276,0.157c-0.026,0.019-0.051,0.038-0.077,0.059c-0.093,0.076-0.178,0.159-0.249,0.254
			c-0.004,0.006-0.01,0.009-0.014,0.015L0.289,23.78c-0.293,0.401-0.369,0.923-0.202,1.391c0.167,0.469,0.556,0.823,1.038,0.947
			l6.634,1.713v16.401c0,0.659,0.431,1.242,1.062,1.435l24.29,7.422c0.008,0.004,0.017,0.001,0.025,0.005
			c0.13,0.036,0.266,0.059,0.402,0.06c0.003,0,0.007,0.002,0.011,0.002l0,0h0.001c0.143,0,0.283-0.026,0.423-0.067
			c0.044-0.014,0.085-0.033,0.13-0.052c0.059-0.022,0.117-0.038,0.175-0.068l17.43-9.673c0.477-0.265,0.772-0.767,0.772-1.312
			V25.586l5.896-2.83c0.397-0.19,0.69-0.547,0.802-0.973c0.111-0.427,0.03-0.88-0.223-1.241L51.586,10.029z M27.41,9.111
			l17.644,2.59L33.35,17.143l-18.534-3.415L27.41,9.111z M9.801,15.854l21.237,3.914l-6.242,9.364l-20.78-5.365L9.801,15.854z
			 M10.759,43.122V28.605l14.318,3.697c0.125,0.031,0.25,0.048,0.375,0.048c0.493,0,0.965-0.244,1.248-0.668l5.349-8.023v25.968
			L10.759,43.122z M49.479,41.1l-14.431,8.007V25.414l2.635,5.599c0.171,0.361,0.479,0.641,0.854,0.773
			c0.163,0.06,0.333,0.087,0.502,0.087c0.223,0,0.444-0.05,0.649-0.146l9.789-4.698L49.479,41.1L49.479,41.1z M39.755,28.368
			l-4.207-8.938L49.85,12.78l5.634,8.037L39.755,28.368z`})})})}),k=o.forwardRef,ee=N(null),se=k((t,s)=>{const{children:r,show:n=!0,...a}=t,{className:i,...l}=a;return e.jsx(w,{mode:"wait",children:n&&e.jsx(b.button,{ref:s,"aria-label":"Floating action button",initial:{opacity:.3,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:.3,scale:.8},className:f("mt-2 flex items-center justify-center","h-12 w-12 text-lg md:h-10 md:w-10 md:text-base","border border-accent outline-accent hover:opacity-100 focus:opacity-100 focus:outline-none","rounded-xl border border-zinc-400/20 shadow-lg backdrop-blur-lg dark:border-zinc-500/30 dark:bg-zinc-800/80 dark:text-zinc-200","bg-slate-50/80 shadow-lg dark:bg-neutral-900/80","transition-all duration-500 ease-in-out",i),...l,children:r})})});k((t,s)=>{const{onClick:r,children:n}=t,a=o.useId(),i=W(ee),l=q();return t.onlyShowInMobile&&!l||!i?null:e.jsx(E,{to:i,children:e.jsx(se,{ref:s,id:a,onClick:r,children:n})})});const te=({children:t,className:s})=>e.jsx("ul",{className:d("shiro-timeline",s),children:t});o.memo(function(s){const{count:r,name:n}=s;return e.jsx(X,{count:r,text:n,onClick:s.onClick,passProps:s})});const re=t=>{const{name:s}=t,{data:r,isLoading:n}=p({queryKey:[s,"tag"],queryFn:async({queryKey:i})=>{const[l]=i;return(await v.category.getTagByName(l)).data},staleTime:1e3*60*60*24}),{dismissAll:a}=h();return n?e.jsx("div",{className:"h-30 loading-dots flex w-full center"}):r?e.jsx(te,{children:r.map(i=>e.jsx("li",{className:"flex items-center justify-between","data-id":i.id,children:e.jsxs("span",{className:"flex min-w-0 flex-shrink items-center",children:[e.jsx("span",{className:"mr-2 inline-block w-12 tabular-nums",children:Intl.DateTimeFormat("en-us",{month:"2-digit",day:"2-digit"}).format(new Date(i.created))}),e.jsx(g,{onClick:()=>{a()},prefetch:!1,href:j(y.Post,{category:i.category.slug,slug:i.slug}),className:"min-w-0 truncate leading-6",children:e.jsx("span",{className:"min-w-0 truncate",children:i.title})})]})},i.id))}):e.jsx(_,{})},M=({className:t,meta:s})=>{const{present:r}=h(),n=F();return e.jsxs("div",{className:f("flex min-w-0 flex-shrink flex-grow flex-wrap gap-2 text-sm",t),children:[e.jsxs("div",{className:"flex min-w-0 items-center space-x-1",children:[!!s.created&&e.jsxs(e.Fragment,{children:[e.jsx(I,{}),e.jsx("span",{children:e.jsx(m,{date:s.created})})]}),!!s.modified&&e.jsxs(V,{wrapperClassName:"text-xs",as:"span",type:"tooltip",TriggerComponent:()=>"(已编辑)",children:["编辑于 ",e.jsx(m,{date:s.modified})]})]}),!!s.category&&e.jsxs("div",{className:"flex min-w-0 items-center space-x-1",children:[e.jsx(U,{className:"translate-y-[0.5px]"}),e.jsxs("span",{className:"min-w-0 truncate",children:[e.jsx(A,{onClick:()=>!!s.category&&n.push(j(y.Category,{slug:s.category.slug})),className:"shiro-link--underline font-normal",children:e.jsx("span",{children:s.category?.name})}),s.tags?.length?e.jsxs(e.Fragment,{children:[" ","/"," ",s.tags.map((a,i)=>{const l=i===s.tags.length-1;return e.jsxs(o.Fragment,{children:[e.jsx("button",{className:"shiro-link--underline",onClick:()=>r({content:()=>e.jsx(re,{name:a}),title:`Tag: ${a}`}),children:a},a),!l&&e.jsx("span",{children:", "})]},a)})]}):""]})]}),!!s.count?.read&&e.jsxs("div",{className:"flex min-w-0 items-center space-x-1",children:[e.jsx("i",{className:"icon-[mingcute--eye-2-line]"}),e.jsx("span",{className:"min-w-0 truncate",children:s.count.read})]}),!!s.count?.like&&e.jsxs("div",{className:"flex min-w-0 items-center space-x-1",children:[e.jsx(Y,{}),e.jsx("span",{className:"min-w-0 truncate",children:e.jsx(R,{children:s.count.like})})]})]})},ne=()=>{const t=c(s=>s?.text);return t?e.jsx(Z,{allowsScript:!0,value:t,className:"min-w-0 overflow-hidden"}):null},ae=t=>{const s=c(r=>r?.images||x);return e.jsx(H,{images:s||x,children:t.children})},ie=({className:t})=>{const s=c(r=>{if(r)return{created:r.created,category:r.category,tags:r.tags,count:r.count,modified:r.modified}});return s?e.jsx(M,{meta:s,className:t}):null},oe=({pin:t,id:s})=>{const[r,n]=o.useState(t);return e.jsx(J,{onPinChange:async a=>{await v.post.proxy(s).patch({data:{pin:a}}),n(a)},pin:r})},le=()=>{const[t,s]=o.useState(!1),r=o.useRef(null);return o.useEffect(()=>{const n=r.current;if(!n)return;const a=n.parentElement;if(a)return a.onfocus=()=>{s(!0)},a.onblur=()=>{s(!1)},()=>{a.onfocus=null,a.onblur=null}},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:r,className:"absolute inset-0 z-10",onMouseEnter:()=>{s(!0)},onMouseLeave:()=>{s(!1)}}),e.jsx(w,{children:t&&e.jsx(b.div,{layout:!0,initial:{opacity:.2,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},layoutId:"post-item-hover-overlay",className:d("absolute z-[-1] rounded-xl","bg-slate-300/50 dark:bg-neutral-800","bottom-[1rem] left-[-1rem] right-[-1.5rem] top-[1rem]")})})]})};o.memo(function({data:s}){const r=s.text.length>300?`${G(s.text.slice(0,300))}...`:s.text,n=s.images?.length>0&&s.images[0].src,i=`/posts/${s.category?.slug}/${s.slug}`;return e.jsxs(g,{href:i,className:"relative flex flex-col py-8 focus-visible:!shadow-none",children:[e.jsx(le,{}),e.jsxs("h2",{className:"relative break-words text-2xl font-medium",children:[e.jsx(P,{children:s.title}),e.jsx(oe,{pin:!!s.pin,id:s.id})]}),e.jsxs("main",{className:"relative mt-8 space-y-2",children:[!!s.summary&&e.jsxs("p",{className:"break-all leading-relaxed text-gray-900 dark:text-slate-50",children:["摘要： ",s.summary]}),e.jsxs("div",{className:"relative overflow-hidden text-justify",children:[n&&e.jsx("div",{className:d("float-right mb-2 ml-3 h-[5.5rem] w-[5.5rem] overflow-hidden rounded-md","bg-cover bg-center bg-no-repeat"),style:{backgroundImage:`url(${n})`}}),e.jsx("p",{className:"break-all leading-loose text-gray-800/90 dark:text-gray-200/90",children:r})]})]}),e.jsxs("div",{className:"post-meta-bar mt-2 flex select-none flex-wrap items-center justify-end gap-4 text-base-content/60",children:[e.jsx(M,{meta:s}),e.jsxs("span",{className:"flex flex-shrink-0 select-none items-center space-x-1 text-right text-accent hover:text-accent [&>svg]:hover:ml-2",children:[e.jsx("span",{children:"阅读全文"}),e.jsx("i",{className:"icon-[mingcute--arrow-right-line] text-lg transition-[margin]"})]})]})]})});const ce=()=>{const t=c(s=>s?.modified);return t&&u().diff(u(t),"day")>60?e.jsx(K,{type:"warning",className:"my-10",children:e.jsxs("span",{className:"leading-[1.8]",children:["这篇文章上次修改于 ",e.jsx(m,{date:t}),"，可能部分内容已经不适用，如有疑问可询问作者。"]})}):null},Ke=t=>{const{category:s,slug:r}=t,{data:n,isLoading:a}=p({...T.post.bySlug(s,r)}),i=o.useMemo(()=>N(null),[]);return a?e.jsx(Q,{className:"w-full",useDefaultLoadingText:!0}):n?e.jsxs(D,{overrideAtom:i,children:[e.jsx($,{data:n}),!!n.id&&e.jsx(C,{id:n.id,type:"post"}),e.jsx(B,{children:e.jsxs("article",{className:"prose relative w-full min-w-0",children:[e.jsxs("header",{className:"mb-8",children:[e.jsx("h1",{className:"text-center",children:e.jsx(L,{children:n.title})}),e.jsx(ie,{className:"mb-8 justify-center"}),e.jsx(S,{cid:z(n)}),e.jsx(ce,{})]}),e.jsx(O,{children:e.jsx(ae,{children:e.jsx(ne,{})})})]})})]}):null};export{Ke as PostPreview};
